<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>çŸ­çŸ­çš„è–èª•æ¨¹ ğŸ„</title>
<style>
body { margin:0; background:#14233b; overflow:hidden; font-family:Arial; }
#title { position:absolute; top:10px; width:100%; text-align:center; font-size:28px; color:#fff; text-shadow:0 0 10px #ff0000; font-weight:bold; }
#score { position:absolute; top:60px; width:100%; text-align:center; font-size:22px; color:#fff; }
canvas { display:block; }
</style>
</head>
<body>
<div id="title">ğŸ„ For çŸ­çŸ­ ğŸ„</div>
<div id="score">æ¨¹é«˜ï¼š0</div>
<canvas id="game"></canvas>
<audio id="bonkSound" preload="auto">
<source src="https://cdn.pixabay.com/audio/2021/09/16/audio_63e63d76f7.mp3" type="audio/mpeg">
</audio>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bonk = document.getElementById("bonkSound");

let tree=[], speed=6, movingX=0, direction=1, level=0;
let lastClickTime=0, clickCooldown=200; // é»æ“Šå†·å»
const originalWidth=200;

// Canvas è‡ªé©æ‡‰æ‰‹æ©Ÿè¢å¹•
function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// è¨ˆç®—æ¯å±¤æ–¹å¡Šå¯¬åº¦
function getLayerWidth(level){
    if(level<5) return originalWidth * Math.pow(0.8, level);
    else return originalWidth * Math.pow(0.95, level-5);
}

// è¨ˆç®—é¡è‰²
function getColor(level){
    if(level===29) return "#FFD700"; // ç¬¬30å±¤é»ƒè‰²
    return level<5 ? "#8B4513" : "#2ecc40";
}

// ç•«æ–¹å¡Š
function drawRect(x,y,w,h,color){ ctx.fillStyle=color; ctx.fillRect(x,y,w,h); }

// é›ªèŠ±æ•ˆæœ
let snows = Array.from({length:50},()=>({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*2+1}));
function drawSnow(){ 
    ctx.fillStyle="white"; 
    for(let s of snows){ 
        ctx.beginPath(); 
        ctx.arc(s.x,s.y,s.s,0,Math.PI*2); 
        ctx.fill(); 
        s.y+=s.s*0.5; 
        if(s.y>canvas.height){s.y=-5; s.x=Math.random()*canvas.width;}
    }
}

// ä¸»å¾ªç’°
function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    let movingWidth = getLayerWidth(level);
    movingX += speed*direction;
    if(movingX+movingWidth>canvas.width || movingX<0) direction*=-1;

    drawRect(movingX,80,movingWidth,20,getColor(level));
    for(let t of tree) drawRect(t.x,t.y,t.w,20,t.color);

    drawSnow();
    requestAnimationFrame(loop);
}
loop();

// é»æ“Šæ‰è½æ–¹å¡Š
function dropLayer(){
    const now = Date.now();
    if(now-lastClickTime<clickCooldown) return; // å†·å»ä¸­
    lastClickTime=now;

    let y = canvas.height - 60 - tree.length*22;
    let movingWidth = getLayerWidth(level);
    let x = movingX;
    let color = getColor(level);

    if(tree.length>0){
        let last = tree[tree.length-1];
        let left = Math.max(x,last.x);
        let right = Math.min(x+movingWidth,last.x+last.w);
        let overlap = right-left;
        if(overlap<=0){
            bonk.currentTime=0; bonk.play().catch(()=>{});
            alert("ğŸ„ å’šï¼ï¼çŸ­çŸ­ä½ çš„æ¨¹å€’äº†ï¼\nä½ è“‹äº† "+tree.length+" å±¤ï¼");
            reset();
            return;
        }
    }

    tree.push({x,y,w:movingWidth,color});
    level++;
    document.getElementById("score").innerText="æ¨¹é«˜ï¼š"+level;

    if(level===30){
        setTimeout(()=>{
            alert("ğŸ‘ å¤§æ‹‡æŒ‡ï¼");
            reset();
        },50);
    }
}

function reset(){ tree=[]; level=0; document.getElementById("score").innerText="æ¨¹é«˜ï¼š0"; }

document.addEventListener("click",dropLayer);
document.addEventListener("touchstart",dropLayer);
</script>
</body>
</html>
